<?xml version="1.0"?>
<xh:html xmlns:xh="http://www.w3.org/1999/xhtml" xmlns:xf="http://www.w3.org/2002/xforms" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xxf="http://orbeon.org/oxf/xml/xforms" xmlns:fr="http://orbeon.org/oxf/xml/form-runner">
  <xh:head>
    <xh:title>Call Information</xh:title>
    <xf:model id="fr-form-model" xxf:expose-xpath-types="true">
      <xf:var name="is-applicant" value="(xxf:get-request-header('role')  = 'applicant')"/>
      <!-- Main instance -->
      <xf:instance id="fr-form-instance" xxf:exclude-result-prefixes="#all">
        <call>
          <programme-details>
            <fund itemset-empty="false"/>
            <programme itemset-empty="true"/>
            <programme-priority-axis itemset-empty="true"/>
            <programme-investment-priority-grid>
              <programme-investment-priority-grid-iteration>
                <programme-investment-priority/>
              </programme-investment-priority-grid-iteration>
            </programme-investment-priority-grid>
          </programme-details>
          <call-details>
            <call-name/>
            <call-reference-number/>
            <published-date/>
            <call-access>RC</call-access>
            <call-type itemset-empty="false"/>
            <straight-to-application/>
            <call-summary-description/>
            <call-open-date/>
            <call-close-date/>
            <call-manager-details>
              <call-manager-details-iteration>
                <call-manager/>
                <call-manager-email/>
              </call-manager-details-iteration>
            </call-manager-details>
            <call-doc-grid>
              <call-doc-iteration>
                <call-document filename="" mediatype="" size=""/>
                <call-document-category itemset-empty="false"/>
                <call-document-description/>
              </call-doc-iteration>
            </call-doc-grid>
          </call-details>
          <call-financial-details>
            <call-budget-allocation/>
            <call-minimum-funding/>
            <call-intervention-rate/>
          </call-financial-details>
          <leps>
            <lep-list>
              <lep-list-iteration>
                <lep itemset-empty="false"/>
              </lep-list-iteration>
            </lep-list>
          </leps>
          <indicators>
            <programme-indicators>
              <programme-indicators-iteration>
                <programme-indicator itemset-empty="true"/>
              </programme-indicators-iteration>
            </programme-indicators>
          </indicators>
          <scoring>
            <scoring-criteria/>
          </scoring>
          <call-timeline-details>
            <timeline-dates>
              <timeline-dates-iteration>
                <timeline-date/>
                <timeline-date-description/>
              </timeline-dates-iteration>
            </timeline-dates>
          </call-timeline-details>
          <confirmation>
            <call-published-gov-uk/>
            <make-active/>
            <continue-btn/>
            <delete-btn/>
            <make-active-additional-docs-grid>
              <make-active-additional-docs-grid-iteration>
                <make-active-additional-docs filename="" mediatype="" size=""/>
                <make-active-additional-docs-category itemset-empty="false"/>
                <make-active-additional-docs-description/>
              </make-active-additional-docs-grid-iteration>
            </make-active-additional-docs-grid>
            <make-active-notes/>
            <activation-notes/>
          </confirmation>
          <audit-info>
            <status>draft</status>
          </audit-info>
        </call>
      </xf:instance>
         
      <!-- custom submission to make form active -->
      <xf:submission id="create-instance" method="put" instance="fr-form-instance" replace="instance" serialization="application/xml" validate="true" relevant="false" resource="/fr/service/persistence/crud/erdf/add-call/data/{xxf:instance('fr-parameters-instance')/document}/data.xml?apply-transformation=true">
        <xf:header combine="replace">
          <xf:name>Accept</xf:name>
          <xf:value>application/xml</xf:value>
        </xf:header>
        <xf:header>
          <xf:name>Orbeon-Form-Definition-Version</xf:name>
          <xf:value value="xxf:instance('fr-parameters-instance')/form-version"/>
        </xf:header>
        <xf:action ev:event="xforms-submit-error">
          <xf:message level="modal">
            <xf:output value="'There are validation errors. Please check your selections and entries, and retry once all fields have been filled out.'"/>
          </xf:message>
          <xf:setvalue ref="xxf:instance('fr-form-instance')//*:status" value="'draft'"/>
          <xf:setvalue ref="xxf:instance('fr-form-instance')//*:published-date" value="''"/>
        </xf:action>
        <xf:action ev:event="xforms-submit-done">
          <xf:dispatch target="message-dialog" name="fr-show">
            <xf:property name="message" value="'Call Activated.'"/>
          </xf:dispatch>
        </xf:action>
      </xf:submission>
      <!-- activate activation notes section if call is already active. -->
      <xf:action ev:event="xforms-ready" if="xxf:instance('fr-form-instance')/*:audit-info/*:status = 'active'">
        <xf:toggle case="unhide-notes" ev:event="DOMActivate"/>
      </xf:action>
      <!-- Bindings -->
      <xf:bind id="fr-form-binds" ref="instance('fr-form-instance')">
        <xf:bind id="programme-details-bind" name="programme-details" ref="programme-details" readonly="$is-applicant">
          <xf:bind id="programme-bind" ref="programme" name="programme"/>
          <xf:bind id="programme-priority-axis-bind" name="programme-priority-axis" ref="programme-priority-axis"/>
          <xf:bind id="fund-bind" ref="fund" name="fund" required="true()"/>
          <xf:bind id="programme-investment-priority-grid-bind" ref="programme-investment-priority-grid" name="programme-investment-priority-grid">
            <xf:bind id="programme-investment-priority-grid-iteration-bind" ref="programme-investment-priority-grid-iteration" name="programme-investment-priority-grid-iteration">
              <xf:bind id="programme-investment-priority-bind" ref="programme-investment-priority" name="programme-investment-priority"/>
            </xf:bind>
          </xf:bind>
        </xf:bind>
        <xf:bind id="call-details-bind" ref="call-details" name="call-details" readonly="$is-applicant">
          <xf:bind id="call-name-bind" ref="call-name" name="call-name" required="true()" constraint="if(normalize-space(.) != '') then true() else false()"/>
          <xf:bind id="call-summary-description-bind" ref="call-summary-description" name="call-summary-description"/>
          <xf:bind id="call-open-date-bind" ref="call-open-date" name="call-open-date" type="xs:date" required="true()"/>
          <xf:bind id="call-close-date-bind" ref="call-close-date" name="call-close-date" type="xs:date" required="true()">
            <xf:constraint id="constraint-43-constraint" value="if(instance('fr-form-instance')/*:call-details/*:call-open-date/string() eq '') then true() else  (if(xs:date(instance('fr-form-instance')/*:call-details/*:call-close-date) ge xs:date(instance('fr-form-instance')/*:call-details/*:call-open-date)) then true() else false())" level="error"/>
          </xf:bind>
          <xf:bind id="call-manager-details-bind" ref="call-manager-details" name="call-manager-details">
            <xf:bind id="call-manager-details-iteration-bind" ref="call-manager-details-iteration" name="call-manager-details-iteration">
              <xf:bind id="call-manager-bind" ref="call-manager" name="call-manager"/>
              <xf:bind id="call-manager-email-bind" ref="call-manager-email" name="call-manager-email" type="xf:email"/>
            </xf:bind>
          </xf:bind>
          <xf:bind id="call-doc-grid-bind" ref="call-doc-grid" name="call-doc-grid">
            <xf:bind id="call-doc-iteration-bind" ref="call-doc-iteration" name="call-doc-iteration">
              <xf:bind id="call-document-bind" ref="call-document" name="call-document" type="xf:anyURI">
                <xf:constraint id="constraint-53-constraint" value="if(@filename ne '') then (ends-with(lower-case(@filename), 'doc') or ends-with(lower-case(@filename), 'docx') or ends-with(lower-case(@filename), 'rtf') or ends-with(lower-case(@filename), 'odf') or ends-with(lower-case(@filename), 'txt') or ends-with(lower-case(@filename), 'pdf') or ends-with(lower-case(@filename), 'xls') or ends-with(lower-case(@filename), 'xlsx') or ends-with(lower-case(@filename), 'jpg') or ends-with(lower-case(@filename), 'png')) else true()" level="error"/>
              </xf:bind>
              <xf:bind id="call-document-category-bind" ref="call-document-category" name="call-document-category" required="if(../*:call-document/@filename != '') then true() else false()" relevant="if(../*:call-document/@filename != '') then true() else false()"/>
              <xf:bind id="call-document-description-bind" ref="call-document-description" name="call-document-description" required="if(../*:call-document/@filename != '') then true() else false()" relevant="if(../*:call-document/@filename != '') then true() else false()"/>
            </xf:bind>
          </xf:bind>
          <xf:bind id="call-access-bind" ref="call-access" name="call-access" required="true()"/>
          <xf:bind id="call-type-bind" ref="call-type" name="call-type" required="true()"/>
          <xf:bind id="call-reference-number-bind" ref="call-reference-number" name="call-reference-number" readonly="true()" relevant="if(exists(instance('fr-form-instance')/*:call-details/*:call-reference-number/text())) then true() else false()"/>
          <xf:bind id="published-date-bind" ref="published-date" name="published-date" readonly="true()" relevant="if(exists(instance('fr-form-instance')/*:call-details/*:published-date/text())) then true() else false()"/>
          <xf:bind id="straight-to-application-bind" ref="*:straight-to-application" name="straight-to-application" type="xf:boolean"/>
        </xf:bind>
        <xf:bind id="call-financial-details-bind" ref="call-financial-details" name="call-financial-details" readonly="$is-applicant">
          <xf:bind id="call-intervention-rate-bind" ref="call-intervention-rate" name="call-intervention-rate" type="xf:nonNegativeInteger">
            <xf:constraint id="constraint-55-constraint" value="(./string() eq '') or ((. ge 0) and (. le 100))" level="error"/>
          </xf:bind>
          <xf:bind id="call-budget-allocation-bind" ref="call-budget-allocation" name="call-budget-allocation" type="xf:decimal">
            <xf:constraint id="constraint-58-constraint" value="if(string(.) ne '') then ( if(. lt 0) then false() else true() ) else true()" level="error"/>
            <xf:constraint id="constraint-60-constraint" value="string-length(substring-after(string(.),'.')) le 2" level="error"/>
          </xf:bind>
          <xf:bind id="call-minimum-funding-bind" ref="call-minimum-funding" name="call-minimum-funding" type="xf:decimal">
            <xf:constraint id="constraint-59-constraint" value="if(string(.) ne '') then ( if(. lt 0) then false() else true() ) else true()" level="error"/>
            <xf:constraint id="constraint-61-constraint" value="string-length(substring-after(string(.),'.')) le 2" level="error"/>
          </xf:bind>
        </xf:bind>
        <xf:bind id="leps-bind" ref="leps" name="leps" readonly="$is-applicant">
          <xf:bind id="lep-list-bind" ref="lep-list" name="lep-list">
            <xf:bind id="lep-list-iteration-bind" ref="lep-list-iteration" name="lep-list-iteration">
              <xf:bind id="lep-bind" ref="lep" name="lep" required="true()"/>
            </xf:bind>
          </xf:bind>
        </xf:bind>
        <xf:bind id="indicators-bind" ref="indicators" name="indicators" readonly="$is-applicant">
          <xf:bind id="programme-indicators-bind" ref="programme-indicators" name="programme-indicators">
            <xf:bind id="programme-indicators-iteration-bind" ref="programme-indicators-iteration" name="programme-indicators-iteration">
              <xf:bind id="programme-indicator-bind" ref="programme-indicator" name="programme-indicator"/>
            </xf:bind>
          </xf:bind>
        </xf:bind>
        <xf:bind id="scoring-bind" ref="scoring" name="scoring" readonly="$is-applicant">
          <xf:bind id="scoring-criteria-bind" ref="scoring-criteria" name="scoring-criteria"/>
        </xf:bind>
        <xf:bind id="call-timeline-details-bind" ref="call-timeline-details" name="call-timeline-details" readonly="$is-applicant">
          <xf:bind id="timeline-dates-bind" ref="timeline-dates" name="timeline-dates">
            <xf:bind id="timeline-dates-iteration-bind" ref="timeline-dates-iteration" name="timeline-dates-iteration">
              <xf:bind id="timeline-date-bind" ref="timeline-date" name="timeline-date" type="xf:date"/>
              <xf:bind id="timeline-date-description-bind" ref="timeline-date-description" name="timeline-date-description"/>
            </xf:bind>
          </xf:bind>
        </xf:bind>
        <xf:bind id="confirmation-bind" ref="confirmation" name="confirmation" readonly="$is-applicant">
          <xf:bind id="call-published-gov-uk-bind" ref="call-published-gov-uk" name="call-published-gov-uk"/>
          <xf:bind id="make-active-bind" ref="make-active" name="make-active" relevant="if(instance('fr-form-instance')/*:audit-info/*:status != 'active') then true() else false()"/>
          <xf:bind id="make-active-notes-bind" ref="make-active-notes" name="make-active-notes"/>
          <xf:bind id="make-active-additional-docs-grid-bind" ref="make-active-additional-docs-grid" name="make-active-additional-docs-grid">
            <xf:bind id="make-active-additional-docs-grid-iteration-bind" ref="make-active-additional-docs-grid-iteration" name="make-active-additional-docs-grid-iteration">
              <xf:bind id="make-active-additional-docs-bind" ref="make-active-additional-docs" name="make-active-additional-docs" type="xf:anyURI">
                <xf:constraint id="constraint-54-constraint" value="if(@filename ne '') then (ends-with(lower-case(@filename), 'doc') or ends-with(lower-case(@filename), 'docx') or ends-with(lower-case(@filename), 'rtf') or ends-with(lower-case(@filename), 'odf') or ends-with(lower-case(@filename), 'txt') or ends-with(lower-case(@filename), 'pdf') or ends-with(lower-case(@filename), 'xls') or ends-with(lower-case(@filename), 'xlsx') or ends-with(lower-case(@filename), 'jpg') or ends-with(lower-case(@filename), 'png')) else true()" level="error"/>
              </xf:bind>
              <xf:bind id="make-active-additional-docs-description-bind" ref="make-active-additional-docs-description" name="make-active-additional-docs-description" required="if(../*:make-active-additional-docs/@filename != '') then true() else false()" relevant="if(../*:make-active-additional-docs/@filename != '') then true() else false()"/>
              <xf:bind id="make-active-additional-docs-category-bind" ref="make-active-additional-docs-category" name="make-active-additional-docs-category" required="if(../*:make-active-additional-docs/@filename != '') then true() else false()" relevant="if(../*:make-active-additional-docs/@filename != '') then true() else false()"/>
            </xf:bind>
          </xf:bind>
          <xf:bind id="continue-btn-bind" ref="continue-btn" name="continue-btn" relevant="if(instance('fr-form-instance')/*:audit-info/*:status != 'active') then true() else false()"/>
          <xf:bind id="activation-notes-bind" ref="activation-notes" name="activation-notes"/>
          <xf:bind id="delete-btn-bind" ref="delete-btn" name="delete-btn"/>
        </xf:bind>
        <xf:bind id="audit-info-bind" ref="audit-info" name="audit-info">
          <xf:bind id="status-bind" ref="status" name="status"/>
        </xf:bind>
      </xf:bind>
      <!-- Metadata -->
      <xf:instance xxf:readonly="true" id="fr-form-metadata" xxf:exclude-result-prefixes="#all">
        <metadata>
          <application-name>erdf</application-name>
          <form-name>add-call</form-name>
          <title xml:lang="en">Call Information</title>
          <description xml:lang="en">Call Managers will use this form to manage calls to a
                        programme's priority axis</description>
          <singleton>false</singleton>
        </metadata>
      </xf:instance>
      <!-- Attachments -->
      <xf:instance id="fr-form-attachments" xxf:exclude-result-prefixes="#all">
        <attachments>
          <css mediatype="text/css" filename="" size=""/>
          <pdf mediatype="application/pdf" filename="" size=""/>
        </attachments>
      </xf:instance>
      <!-- All form resources -->
      <!-- Don't make readonly by default in case a service modifies the resources -->
      <xf:instance id="fr-form-resources" xxf:readonly="false" xxf:exclude-result-prefixes="#all">
        <resources>
          <resource xml:lang="en">
            <programme-investment-priority>
              <label>Programme Investment Priority</label>
              <hint/>
            </programme-investment-priority>
            <apply-now-btn>
              <label>Apply Now</label>
              <hint/>
            </apply-now-btn>
            <call-budget-allocation>
              <label>Indicative Budget Allocated to the Call</label>
              <hint/>
              <alert>The value is negative</alert>
              <alert>Only 2 decimal digits allowed. eg. 10000.25</alert>
              <alert>Incorrect Value</alert>
            </call-budget-allocation>
            <call-minimum-funding>
              <label>Minimum Funding Request Accepted</label>
              <hint/>
              <alert>The value is negative</alert>
              <alert>Only 2 decimal digits allowed. eg. 10000.25</alert>
              <alert>Incorrect Value</alert>
            </call-minimum-funding>
            <status>
              <label>Current Status</label>
              <hint/>
            </status>
            <make-active-additional-docs>
              <label>Make Active Additional Documents</label>
              <hint/>
              <alert>The type of file selected is not permitted for upload</alert>
            </make-active-additional-docs>
            <make-active-additional-docs-category>
              <label>File Category</label>
              <hint/>
            </make-active-additional-docs-category>
            <make-active-additional-docs-description>
              <label>File Description</label>
              <hint/>
            </make-active-additional-docs-description>
            <lep>
              <label>LEP</label>
              <hint/>
            </lep>
            <call-indicator>
              <label>Call Indicators</label>
              <hint/>
            </call-indicator>
            <programme-indicator>
              <label>Programme Indicators</label>
              <hint/>
            </programme-indicator>
            <call-published-gov-uk>
              <label/>
              <hint/>
              <item>
                <label>Published to gov.uk ?</label>
                <hint>Confirm that the call has been published to the gov.uk
                                    website</hint>
                <value>yes</value>
              </item>
            </call-published-gov-uk>
            <make-active>
              <label>Make active</label>
              <hint/>
            </make-active>
            <continue-btn>
              <label>Continue</label>
              <hint/>
            </continue-btn>
            <buttons>
              <label>Apply</label>
              <help/>
            </buttons>
            <activation-notes>
              <label>Activation Notes</label>
              <help/>
            </activation-notes>
            <make-active-notes>
              <label>Activation Notes</label>
              <hint/>
            </make-active-notes>
            <call-document>
              <label>Call document</label>
              <hint/>
              <help>Upload the MS word document with the full narrative of the
                                Call</help>
              <alert>The type of file selected is not permitted for upload</alert>
            </call-document>
            <call-document-category>
              <label>Call Document Category</label>
              <hint/>
            </call-document-category>
            <call-document-description>
              <label>Call Document Description</label>
              <hint/>
            </call-document-description>
            <call-manager>
              <label>Call manager name</label>
              <hint/>
            </call-manager>
            <call-manager-email>
              <label>Call manager email address</label>
              <hint/>
            </call-manager-email>
            <timeline-date>
              <label>Timeline Date</label>
              <hint/>
            </timeline-date>
            <timeline-date-description>
              <label>Timeline date description</label>
              <hint/>
            </timeline-date-description>
            <scoring-criteria>
              <label>Scoring Criteria</label>
              <hint/>
              <help>Use this field to capture the criteria that should be used in
                                scoring applications to this call</help>
            </scoring-criteria>
            <call-intervention-rate>
              <label>Maximum Intervention Rate</label>
              <hint/>
              <alert>Allowed values are between 1 to 100</alert>
              <alert>Allowed values are between 0 to 100</alert>
            </call-intervention-rate>
            <leps>
              <label>Local Enterprise Partnerships</label>
              <help/>
            </leps>
            <indicators>
              <label>Indicators </label>
              <help/>
            </indicators>
            <scoring>
              <label>Scoring Criteria</label>
              <help/>
            </scoring>
            <call-timeline-details>
              <label>Call Timeline Dates</label>
              <help/>
            </call-timeline-details>
            <confirmation>
              <label>Confirmation</label>
              <help/>
            </confirmation>
            <programme-details>
              <label>Priority axis for the call</label>
            </programme-details>
            <call-details>
              <label>Call Details</label>
              <help/>
            </call-details>
            <call-name>
              <label>Call Name</label>
              <hint/>
              <alert>Please add a name</alert>
            </call-name>
            <call-reference-number>
              <label>Call Reference Number</label>
              <hint>The reference number is not updated with the new value. Please
                                reload the page for reference number to reflect the latest
                                value.</hint>
            </call-reference-number>
            <status>
              <label>Call Status</label>
              <hint/>
            </status>
            <published-date>
              <label>Published Date</label>
              <hint/>
            </published-date>
            <call-access>
              <label>Access</label>
              <hint/>
              <item>
                <label>Open</label>
                <hint/>
                <value>OC</value>
              </item>
              <item>
                <label>Restricted</label>
                <hint/>
                <value>RC</value>
              </item>
            </call-access>
            <call-type>
              <label>Type</label>
              <hint/>
            </call-type>
            <straight-to-application>
              <label>Straight to Full Application</label>
              <hint/>
            </straight-to-application>
            <call-summary-description>
              <label>Summary Description</label>
              <hint/>
            </call-summary-description>
            <call-open-date>
              <label>Call Open Date</label>
              <hint/>
            </call-open-date>
            <call-close-date>
              <label>Call Close Date</label>
              <hint/>
              <alert>Close date cannot be before open date</alert>
            </call-close-date>
            <fund>
              <label>Fund</label>
              <hint>Select Fund</hint>
            </fund>
            <programme>
              <label>Programme</label>
              <hint>Select Programme</hint>
            </programme>
            <programme-priority-axis>
              <label>Programme Priority Axis</label>
              <hint/>
            </programme-priority-axis>
            <call-financial-details>
              <label>Call Financial Details</label>
              <help/>
            </call-financial-details>
          </resource>
        </resources>
      </xf:instance>
      <!-- Utility instances for services -->
      <xf:instance id="fr-service-request-instance" xxf:exclude-result-prefixes="#all">
        <request/>
      </xf:instance>
      <xf:instance id="fr-service-response-instance" xxf:exclude-result-prefixes="#all">
        <response/>
      </xf:instance>
      <xf:instance xxf:readonly="true" id="lep-list-template" xxf:exclude-result-prefixes="#all">
        <lep-list-iteration>
          <lep/>
        </lep-list-iteration>
      </xf:instance>
      <xf:instance xxf:readonly="true" id="timeline-dates-template" xxf:exclude-result-prefixes="#all">
        <timeline-dates-iteration>
          <timeline-date/>
          <timeline-date-description/>
        </timeline-dates-iteration>
      </xf:instance>
      <xf:instance xxf:readonly="true" id="call-manager-details-template" xxf:exclude-result-prefixes="#all">
        <call-manager-details-iteration>
          <call-manager/>
          <call-manager-email/>
        </call-manager-details-iteration>
      </xf:instance>
      <xf:instance xxf:readonly="true" id="programme-indicators-template" xxf:exclude-result-prefixes="#all">
        <programme-indicators-iteration>
          <programme-indicator/>
        </programme-indicators-iteration>
      </xf:instance>
      <xf:instance xxf:readonly="true" id="call-doc-grid-template" xxf:exclude-result-prefixes="#all">
        <call-doc-iteration>
          <call-document filename="" mediatype="" size=""/>
          <call-document-category itemset-empty="false"/>
          <call-document-description/>
        </call-doc-iteration>
      </xf:instance>
      <xf:instance xxf:readonly="true" id="make-active-additional-docs-grid-template" xxf:exclude-result-prefixes="#all">
        <make-active-additional-docs-grid-iteration>
          <make-active-additional-docs filename="" mediatype="" size=""/>
          <make-active-additional-docs-description/>
          <make-active-additional-docs-category/>
        </make-active-additional-docs-grid-iteration>
      </xf:instance>
      <xf:instance xxf:readonly="true" id="programme-investment-priority-grid-template" xxf:exclude-result-prefixes="#all">
        <programme-investment-priority-grid-iteration>
          <programme-investment-priority/>
        </programme-investment-priority-grid-iteration>
      </xf:instance>
    </xf:model>
  </xh:head>
  <xh:body>
    <fr:view>
      <fr:body xmlns:oxf="http://www.orbeon.com/oxf/processors" xmlns:p="http://www.orbeon.com/oxf/pipeline" xmlns:xbl="http://www.w3.org/ns/xbl">
        <fr:section id="programme-details-control" bind="programme-details-bind">
          <xf:label ref="$form-resources/programme-details/label"/>
          <fr:grid>
            <xh:tr>
              <xh:td>
                <fr:databound-select1 xmlns:xxbl="http://orbeon.org/oxf/xml/xbl" id="fund-control" appearance="minimal" resource="{xxf:property('esif.marklogic.base')}/v1/documents?uri=/reference/lov/funds.xml" bind="fund-bind">
                  <xf:label ref="$form-resources/fund/label"/>
                  <xf:hint ref="$form-resources/fund/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                  <xf:itemset ref="/data/record">
                    <xf:label ref="label"/>
                    <xf:value ref="value"/>
                  </xf:itemset>
                </fr:databound-select1>
              </xh:td>
            </xh:tr>
            <xh:tr>
              <xh:td>
                <fr:databound-select1 xmlns:xxbl="http://orbeon.org/oxf/xml/xbl" id="programme-control" appearance="minimal" resource="{xxf:property('esif.web.base')}/esif-web/search?type=PROGRAMME&amp;q=fund:{../*:fund} AND status:active&amp;format=XML" bind="programme-bind">
                  <xf:label ref="$form-resources/programme/label"/>
                  <xf:hint ref="$form-resources/programme/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                  <xf:itemset ref="/*:results/*:data/*:programme/*:programme-details/*:programme-name">
                    <xf:label ref="text() "/>
                    <xf:value ref="xxf:split(ancestor::*:programme/*:uri,'/')[5]"/>
                  </xf:itemset>
                </fr:databound-select1>
              </xh:td>
            </xh:tr>
            <xh:tr>
              <xh:td>
                <fr:databound-select1 xmlns:xxbl="http://orbeon.org/oxf/xml/xbl" id="programme-priority-axis-control" appearance="minimal" resource="/fr/service/persistence/crud/erdf/add-programme/data/{ xxf:bind('programme-bind') }/data.xml" bind="programme-priority-axis-bind">
                  <xf:label ref="$form-resources/programme-priority-axis/label"/>
                  <xf:hint ref="$form-resources/programme-priority-axis/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                  <xf:itemset ref="/*:programme/*:priority-axes/*:priority-axes-iteration">
                    <xf:label ref="*:priority-axis-name"/>
                    <xf:value ref="*:priority-axis-name"/>
                  </xf:itemset>
                </fr:databound-select1>
              </xh:td>
            </xh:tr>
          </fr:grid>
          <fr:grid id="programme-investment-priority-grid-control" bind="programme-investment-priority-grid-bind" repeat="content" min="1" template="instance('programme-investment-priority-grid-template')">
            <xh:tr>
              <xh:td>
                <fr:databound-select1 xmlns:xxbl="http://orbeon.org/oxf/xml/xbl" id="programme-investment-priority-control" appearance="minimal" resource="/fr/service/persistence/crud/erdf/add-programme/data/{ xxf:bind('programme-bind') }/data.xml" bind="programme-investment-priority-bind">
                  <xf:label ref="$form-resources/programme-investment-priority/label"/>
                  <xf:hint ref="$form-resources/programme-investment-priority/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                  <xf:itemset ref="/*:programme/*:priority-axes/*:priority-axes-iteration[*:priority-axis-name eq xxf:instance('fr-form-instance')//*:programme-priority-axis]/*:investment-priority/*:investment-priority-iteration">
                    <xf:label ref="concat(*:investment-priority-id, ' - ', *:investment-priority-short-name )"/>
                    <xf:value ref="concat(*:investment-priority-id, ' - ', *:investment-priority-short-name )"/>
                  </xf:itemset>
                </fr:databound-select1>
              </xh:td>
            </xh:tr>
          </fr:grid>
        </fr:section>
        <fr:section id="call-details-control" bind="call-details-bind">
          <xf:label ref="$form-resources/call-details/label"/>
          <fr:grid>
            <xh:tr>
              <xh:td>
                <xf:input id="call-name-control" bind="call-name-bind">
                  <xf:label ref="$form-resources/call-name/label"/>
                  <xf:hint ref="$form-resources/call-name/hint"/>
                  <xf:alert ref="$form-resources/call-name/alert"/>
                </xf:input>
              </xh:td>
            </xh:tr>
            <xh:tr>
              <xh:td>
                <xf:output id="call-reference-number-control" bind="call-reference-number-bind">
                  <xf:label ref="$form-resources/call-reference-number/label"/>
                  <xf:hint ref="$form-resources/call-reference-number/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </xf:output>
              </xh:td>
            </xh:tr>
            <xh:tr>
              <xh:td>
                <xf:output id="call-status-control" bind="status-bind">
                  <xf:label ref="$form-resources/status/label"/>
                  <xf:hint ref="$form-resources/status/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </xf:output>
              </xh:td>
            </xh:tr>
            <xh:tr>
              <xh:td>
                <xf:output id="published-date-control" bind="published-date-bind">
                  <xf:label ref="$form-resources/published-date/label"/>
                  <xf:hint ref="$form-resources/published-date/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </xf:output>
              </xh:td>
            </xh:tr>
            <xh:tr>
              <xh:td>
                <xf:select1 id="call-access-control" appearance="full" bind="call-access-bind">
                  <xf:label ref="$form-resources/call-access/label"/>
                  <xf:hint ref="$form-resources/call-access/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                  <xf:itemset ref="$form-resources/call-access/item">
                    <xf:label ref="label"/>
                    <xf:value ref="value"/>
                    <xf:hint ref="hint"/>
                  </xf:itemset>
                </xf:select1>
              </xh:td>
            </xh:tr>
            <xh:tr>
              <xh:td>
                <fr:databound-select1 xmlns:xxbl="http://orbeon.org/oxf/xml/xbl" id="call-type-control" appearance="minimal" resource="{xxf:property('esif.marklogic.base')}/v1/documents?uri=/reference/lov/call-types.xml" bind="call-type-bind">
                  <xf:label ref="$form-resources/call-type/label"/>
                  <xf:hint ref="$form-resources/call-type/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                  <xf:itemset ref="/data/record">
                    <xf:label ref="label"/>
                    <xf:value ref="value"/>
                  </xf:itemset>
                </fr:databound-select1>
              </xh:td>
            </xh:tr>
            <xh:tr>
              <xh:td>
                <xf:input id="straight-to-application-control" bind="straight-to-application-bind">
                  <xf:label ref="$form-resources/straight-to-application/label"/>
                  <xf:hint ref="$form-resources/straight-to-application/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </xf:input>
              </xh:td>
            </xh:tr>
            <xh:tr>
              <xh:td>
                <xf:textarea id="call-summary-description-control" bind="call-summary-description-bind">
                  <xf:label ref="$form-resources/call-summary-description/label"/>
                  <xf:hint ref="$form-resources/call-summary-description/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </xf:textarea>
              </xh:td>
            </xh:tr>
          </fr:grid>
          <fr:grid>
            <xh:tr>
              <xh:td>
                <xf:input id="call-open-date-control" bind="call-open-date-bind">
                  <xf:label ref="$form-resources/call-open-date/label"/>
                  <xf:hint ref="$form-resources/call-open-date/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </xf:input>
              </xh:td>
              <xh:td>
                <xf:input id="call-close-date-control" bind="call-close-date-bind">
                  <xf:label ref="$form-resources/call-close-date/label"/>
                  <xf:hint ref="$form-resources/call-close-date/hint"/>
                  <xf:alert ref="$form-resources/call-close-date/alert" validation="constraint-43-constraint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </xf:input>
              </xh:td>
            </xh:tr>
          </fr:grid>
          <fr:grid id="call-manager-details-control" bind="call-manager-details-bind" repeat="content" min="1" template="instance('call-manager-details-template')">
            <xh:tr>
              <xh:td>
                <xf:input id="call-manager-control" bind="call-manager-bind">
                  <xf:label ref="$form-resources/call-manager/label"/>
                  <xf:hint ref="$form-resources/call-manager/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </xf:input>
              </xh:td>
              <xh:td>
                <xf:input id="call-manager-email-control" bind="call-manager-email-bind">
                  <xf:label ref="$form-resources/call-manager-email/label"/>
                  <xf:hint ref="$form-resources/call-manager-email/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </xf:input>
              </xh:td>
            </xh:tr>
          </fr:grid>
          <fr:grid id="call-doc-grid-control" bind="call-doc-grid-bind" repeat="content" min="1" template="instance('call-doc-grid-template')">
            <xh:tr>
              <xh:td>
                <fr:attachment xmlns="http://orbeon.org/oxf/xml/form-builder" xmlns:xxbl="http://orbeon.org/oxf/xml/xbl" id="call-document-control" bind="call-document-bind" class="fr-attachment">
                  <xf:label ref="$form-resources/call-document/label"/>
                  <xf:hint ref="$form-resources/call-document/hint"/>
                  <xf:help ref="$form-resources/call-document/help"/>
                  <xf:alert ref="$form-resources/call-document/alert" validation="constraint-53-constraint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                  <xf:filename ref="@filename"/>
                  <xf:mediatype ref="@mediatype"/>
                  <xxf:size ref="@size"/>
                  <xf:action ev:event="xforms-value-changed" if="@size = ''">
                    <xf:setvalue ref="../*:call-document-category" value=""/>
                    <xf:setvalue ref="../*:call-document-description" value=""/>
                  </xf:action>
                </fr:attachment>
              </xh:td>
              <xh:td>
                <fr:databound-select1 xmlns:xxbl="http://orbeon.org/oxf/xml/xbl" id="call-document-category-control" appearance="minimal" resource="{xxf:property('esif.marklogic.base')}/v1/documents?uri=/reference/lov/file-categories.xml" bind="call-document-category-bind">
                  <xf:label ref="$form-resources/call-document-category/label"/>
                  <xf:hint ref="$form-resources/call-document-category/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                  <xf:itemset ref="/data/record">
                    <xf:label ref="label"/>
                    <xf:value ref="value"/>
                  </xf:itemset>
                </fr:databound-select1>
              </xh:td>
            </xh:tr>
            <xh:tr>
              <xh:td colspan="2">
                <xf:input id="call-document-description-control" bind="call-document-description-bind">
                  <xf:label ref="$form-resources/call-document-description/label"/>
                  <xf:hint ref="$form-resources/call-document-description/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </xf:input>
              </xh:td>
            </xh:tr>
          </fr:grid>
        </fr:section>
        <fr:section id="call-financial-details-control" bind="call-financial-details-bind">
          <xf:label ref="$form-resources/call-financial-details/label"/>
          <fr:grid>
            <xh:tr>
              <xh:td>
                <fr:currency xmlns="http://orbeon.org/oxf/xml/form-builder" xmlns:xxbl="http://orbeon.org/oxf/xml/xbl" id="call-budget-allocation-control" bind="call-budget-allocation-bind">
                  <xf:label ref="$form-resources/call-budget-allocation/label"/>
                  <xf:hint ref="$form-resources/call-budget-allocation/hint"/>
                  <xf:alert ref="$form-resources/call-budget-allocation/alert[1]" validation="constraint-58-constraint"/>
                  <xf:alert ref="$form-resources/call-budget-allocation/alert[2]" validation="constraint-60-constraint"/>
                  <xf:alert ref="$form-resources/call-budget-allocation/alert[3]"/>
                </fr:currency>
              </xh:td>
              <xh:td>
                <fr:currency xmlns="http://orbeon.org/oxf/xml/form-builder" xmlns:xxbl="http://orbeon.org/oxf/xml/xbl" id="call-minimum-funding-control" bind="call-minimum-funding-bind">
                  <xf:label ref="$form-resources/call-minimum-funding/label"/>
                  <xf:hint ref="$form-resources/call-minimum-funding/hint"/>
                  <xf:alert ref="$form-resources/call-minimum-funding/alert[1]" validation="constraint-59-constraint"/>
                  <xf:alert ref="$form-resources/call-minimum-funding/alert[2]" validation="constraint-61-constraint"/>
                  <xf:alert ref="$form-resources/call-minimum-funding/alert[3]"/>
                </fr:currency>
              </xh:td>
            </xh:tr>
            <xh:tr>
              <xh:td>
                <xf:input id="call-intervention-rate-control" bind="call-intervention-rate-bind">
                  <xf:label ref="$form-resources/call-intervention-rate/label"/>
                  <xf:hint ref="$form-resources/call-intervention-rate/hint"/>
                  <xf:alert ref="$form-resources/call-intervention-rate/alert[1]" validation="constraint-55-constraint"/>
                  <xf:alert ref="$form-resources/call-intervention-rate/alert[2]"/>
                </xf:input>
              </xh:td>
              <xh:td/>
            </xh:tr>
          </fr:grid>
        </fr:section>
        <fr:section id="leps-control" bind="leps-bind">
          <xf:label ref="$form-resources/leps/label"/>
          <fr:grid id="lep-list-control" bind="lep-list-bind" repeat="content" min="1" template="instance('lep-list-template')">
            <xh:tr>
              <xh:td>
                <fr:databound-select1 xmlns:xxbl="http://orbeon.org/oxf/xml/xbl" id="lep-control" appearance="minimal" resource="{xxf:property('esif.marklogic.base')}/v1/documents?uri=/reference/lov/leps.xml" bind="lep-bind">
                  <xf:label ref="$form-resources/lep/label"/>
                  <xf:hint ref="$form-resources/lep/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                  <xf:itemset ref="/data/record">
                    <xf:label ref="label"/>
                    <xf:value ref="value"/>
                  </xf:itemset>
                </fr:databound-select1>
              </xh:td>
            </xh:tr>
          </fr:grid>
        </fr:section>
        <fr:section id="indicators-control" bind="indicators-bind">
          <xf:label ref="$form-resources/indicators/label"/>
          <fr:grid id="programme-indicators-control" bind="programme-indicators-bind" repeat="content" min="1" template="instance('programme-indicators-template')">          
         <!--   <xf:var name="progIdDesc" value="xxf:instance('find-programme')//*:programme-indicators/*:programme-indicators-iteration[*:programme-indicator-code = $progId]/*:indicator-description"/> -->             
      
            <xh:tr>
              <xh:td>
                <fr:databound-select1 xmlns:xxbl="http://orbeon.org/oxf/xml/xbl" id="programme-indicator-control" appearance="minimal" resource="/fr/service/persistence/crud/erdf/add-programme/data/{ xxf:bind('programme-bind') }/data.xml" bind="programme-indicator-bind">
                  <xf:label ref="$form-resources/programme-indicator/label"/>
                  <xf:hint ref="$form-resources/programme-indicator/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>                 
                  <xf:itemset ref="/*:programme/*:priority-axis-indicators/*:priority-axis-indicators-iteration[*:priority-axis-dynamic-dropdown eq xxf:instance('fr-form-instance')//*:programme-priority-axis]">
                    <!-- Added ProgInd Desc for #730 NB current()|context() here is the itemset -->
                    <xf:label value="concat(*:priority-axis-indicator-ref, ' - ', current()/../../*:programme-indicators/*:programme-indicators-iteration[*:programme-indicator-code = current()//*:indicator-code-dynamic-dropdown]/*:indicator-description)"/>
                    <xf:value ref="*:priority-axis-indicator-ref"/>
                  </xf:itemset>
                </fr:databound-select1>
              </xh:td>
            </xh:tr>
          </fr:grid>
        </fr:section>
        <fr:section id="scoring-control" bind="scoring-bind">
          <xf:label ref="$form-resources/scoring/label"/>
          <fr:grid>
            <xh:tr>
              <xh:td>
                <xf:textarea id="scoring-criteria-control" bind="scoring-criteria-bind">
                  <xf:label ref="$form-resources/scoring-criteria/label"/>
                  <xf:hint ref="$form-resources/scoring-criteria/hint"/>
                  <xf:help ref="$form-resources/scoring-criteria/help"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </xf:textarea>
              </xh:td>
            </xh:tr>
          </fr:grid>
        </fr:section>
        <fr:section id="call-timeline-details-control" bind="call-timeline-details-bind">
          <xf:label ref="$form-resources/call-timeline-details/label"/>
          <fr:grid id="timeline-dates-control" bind="timeline-dates-bind" repeat="content" min="1" template="instance('timeline-dates-template')">
            <xh:tr>
              <xh:td>
                <xf:input id="timeline-date-control" bind="timeline-date-bind">
                  <xf:label ref="$form-resources/timeline-date/label"/>
                  <xf:hint ref="$form-resources/timeline-date/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </xf:input>
              </xh:td>
              <xh:td>
                <xf:input id="timeline-date-description-control" bind="timeline-date-description-bind">
                  <xf:label ref="$form-resources/timeline-date-description/label"/>
                  <xf:hint ref="$form-resources/timeline-date-description/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </xf:input>
              </xh:td>
            </xh:tr>
          </fr:grid>
        </fr:section>
        <fr:section id="confirmation-control" bind="confirmation-bind">
          <xf:label ref="$form-resources/confirmation/label"/>
          <fr:grid>
            <xh:tr>
              <xh:td>
                <xf:select id="call-published-gov-uk-control" appearance="full" bind="call-published-gov-uk-bind">
                  <xf:label ref="$form-resources/call-published-gov-uk/label"/>
                  <xf:hint ref="$form-resources/call-published-gov-uk/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                  <xf:itemset ref="$form-resources/call-published-gov-uk/item">
                    <xf:label ref="label"/>
                    <xf:value ref="value"/>
                    <xf:hint ref="hint"/>
                  </xf:itemset>
                </xf:select>
              </xh:td>
            </xh:tr>
            <xh:tr>
              <xh:td>
                <xf:trigger id="make-active-control" bind="make-active-bind">
                  <xf:label ref="$form-resources/make-active/label"/>
                  <xf:hint ref="$form-resources/make-active/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                  <xf:toggle case="unhide-notes" ev:event="DOMActivate"/>
                </xf:trigger>
              </xh:td>
            </xh:tr>
          </fr:grid>
          <xf:switch>
            <xf:case id="hide-notes"> </xf:case>
            <xf:case id="unhide-notes">
              <fr:section id="activation-notes-control" bind="activation-notes-bind">
                <xf:label ref="$form-resources/activation-notes/label"/>
                <fr:grid>
                  <xh:tr>
                    <xh:td>
                      <xf:textarea id="make-active-notes-control" bind="make-active-notes-bind">
                        <xf:label ref="$form-resources/make-active-notes/label"/>
                        <xf:hint ref="$form-resources/make-active-notes/hint"/>
                        <xf:alert ref="$fr-resources/detail/labels/alert"/>
                      </xf:textarea>
                    </xh:td>
                  </xh:tr>
                </fr:grid>
              </fr:section>
              <fr:grid id="make-active-additional-docs-grid-control" bind="make-active-additional-docs-grid-bind" repeat="content" min="1" template="instance('make-active-additional-docs-grid-template')">
                <xh:tr>
                  <xh:td>
                    <fr:attachment xmlns="http://orbeon.org/oxf/xml/form-builder" xmlns:xxbl="http://orbeon.org/oxf/xml/xbl" id="make-active-additional-docs-control" bind="make-active-additional-docs-bind" class="fr-attachment">
                      <xf:label ref="$form-resources/make-active-additional-docs/label"/>
                      <xf:hint ref="$form-resources/make-active-additional-docs/hint"/>
                      <xf:alert ref="$form-resources/make-active-additional-docs/alert" validation="constraint-54-constraint"/>
                      <xf:alert ref="$fr-resources/detail/labels/alert"/>
                      <xf:filename ref="@filename"/>
                      <xf:mediatype ref="@mediatype"/>
                      <xxf:size ref="@size"/>
                      <xf:action ev:event="xforms-value-changed" if="@size = ''">
                        <xf:setvalue ref="../*:make-active-additional-docs-category" value=""/>
                        <xf:setvalue ref="../*:make-active-additional-docs-description" value=""/>
                      </xf:action>
                    </fr:attachment>
                  </xh:td>
                  <xh:td>
                    <fr:databound-select1 xmlns:xxbl="http://orbeon.org/oxf/xml/xbl" id="make-active-additional-docs-category-control" appearance="minimal" resource="{xxf:property('esif.marklogic.base')}/v1/documents?uri=/reference/lov/file-categories.xml" bind="make-active-additional-docs-category-bind">
                      <xf:label ref="$form-resources/make-active-additional-docs-category/label"/>
                      <xf:hint ref="$form-resources/make-active-additional-docs-category/hint"/>
                      <xf:alert ref="$fr-resources/detail/labels/alert"/>
                      <xf:itemset ref="/data/record">
                        <xf:label ref="label"/>
                        <xf:value ref="value"/>
                      </xf:itemset>
                    </fr:databound-select1>
                  </xh:td>
                </xh:tr>
                <xh:tr>
                  <xh:td colspan="2">
                    <xf:input id="make-active-additional-docs-description-control" bind="make-active-additional-docs-description-bind">
                      <xf:label ref="$form-resources/make-active-additional-docs-description/label"/>
                      <xf:hint ref="$form-resources/make-active-additional-docs-description/hint"/>
                      <xf:alert ref="$fr-resources/detail/labels/alert"/>
                    </xf:input>
                  </xh:td>
                </xh:tr>
              </fr:grid>
              <fr:grid>
                <xh:tr>
                  <xh:td>
                    <!-- generic information dialog with ok, the actual message is passed from the message property  -->
                    <fr:alert-dialog id="message-dialog">
                      <fr:label>Information</fr:label>
                      <fr:positive-choice>
                        <fr:label>OK</fr:label>
                        <xf:action event="DOMActivate">
                          <xf:setvalue ref="xxf:instance('fr-persistence-instance')/data-safe-override">true</xf:setvalue>
                          <xf:load resource="/esif-web/call/calls-list"/>
                        </xf:action>
                      </fr:positive-choice>
                    </fr:alert-dialog>
                    <!-- generic confirmation dialog with ok and label, the actual message is passed from the message property  -->
                    <fr:alert-dialog id="confirmation-dialog">
                      <fr:label>Confirmation</fr:label>
                      <fr:positive-choice>
                        <fr:label>OK</fr:label>
                      </fr:positive-choice>
                      <fr:negative-choice>
                        <fr:label>Cancel</fr:label>
                      </fr:negative-choice>
                    </fr:alert-dialog>
                    <xf:trigger id="continue-btn-control" bind="continue-btn-bind">
                      <xf:label ref="$form-resources/continue-btn/label"/>
                      <xf:hint ref="$form-resources/continue-btn/hint"/>
                      <xf:alert ref="$fr-resources/detail/labels/alert"/>
                      <xf:action ev:event="DOMActivate">
                        <xf:dispatch target="confirmation-dialog" name="fr-show">
                          <xf:property name="message" value="'Are you sure you want to make this call active?'"/>
                          <xf:property name="positive-targetid" value="'continue-btn-control'"/>
                        </xf:dispatch>
                      </xf:action>
                      <xf:action event="fr-positive">
                        <xf:setvalue bind="status-bind" value="'active'"/>
                        <xf:setvalue bind="published-date-bind" value="format-date(current-date(), '[D01]/[M01]/[Y]')"/>
                        <xf:send submission="create-instance"/>
                      </xf:action>
                    </xf:trigger>
                  </xh:td>
                </xh:tr>
              </fr:grid>
            </xf:case>
          </xf:switch>
        </fr:section>
         <fr:xforms-inspector/>
      </fr:body>
      <!-- <fr:xforms-inspector/> -->
      <fr:buttons>
        <fr:pdf-button/>
        <fr:save-button ref=".[not($is-applicant) and (instance('fr-form-instance')//*:status eq 'draft')]"/>
        <fr:submit-button ref=".[not($is-applicant) and (instance('fr-form-instance')//*:status eq 'draft')]"/>
        <xf:trigger id="apply-now-btn-control" ref=".[$is-applicant and (instance('fr-form-instance')//*:status eq 'active')]">
          <xf:label ref="$form-resources/apply-now-btn/label"/>
          <xf:hint ref="$form-resources/apply-now-btn/hint"/>
          <xf:alert ref="$fr-resources/detail/labels/alert"/>
          <xf:action ev:event="DOMActivate" if=" (string(xxf:instance('fr-form-instance')//*:straight-to-application) = 'true')">
            <xf:load resource="/esif-web/applications/application/{encode-for-uri(xxf:instance('fr-parameters-instance')//document)}/new"/>
          </xf:action>
          <xf:action ev:event="DOMActivate" if="(string(xxf:instance('fr-form-instance')//*:straight-to-application) = '') or (string(xxf:instance('fr-form-instance')//*:straight-to-application) = 'false')">
            <xf:load resource="/esif-web/applications/outline/{encode-for-uri(xxf:instance('fr-parameters-instance')//document)}/new"/>
          </xf:action>
        </xf:trigger>
      </fr:buttons>
    </fr:view>
  </xh:body>
</xh:html>
